#!/bin/bash
# Check what needs fixing in RuleIQ

cd /home/omar/Documents/ruleIQ

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "           RuleIQ LangGraph Issues Check                      "
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "ğŸ” Issue #1: Underutilized LangGraph Features"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo -n "Checking for Annotated fields: "
grep -r "Annotated\[" --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"

echo -n "Checking for conditional edges: "
grep -r "add_conditional_edges" --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"

echo -n "Checking for checkpointing: "
grep -r "SqliteSaver\|PostgresSaver" --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"
echo ""

echo "ğŸ” Issue #2: Complex Custom RAG System"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo -n "Custom RAG functions: "
grep -r "custom.*rag\|rag.*custom" -i --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"

echo -n "LangChain RAG components: "
grep -r "MultiQueryRetriever\|EnsembleRetriever\|CohereRerank" --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"
echo ""

echo "ğŸ” Issue #3: Celery Usage"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo -n "Celery imports: "
grep -r "from celery\|import celery" --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"

echo -n "Celery tasks: "
grep -r "@celery.*task\|\.delay(\|\.apply_async(" --include="*.py" 2>/dev/null | wc -l | xargs -I {} echo "{} found"

if [ -f "celery_app.py" ]; then
    echo "âŒ celery_app.py exists - needs migration"
fi
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "To fix issues, run:"
echo "  /fix-langgraph  - Fix state management & LangGraph features"
echo "  /fix-rag        - Replace custom RAG with LangChain"
echo "  /fix-celery     - Migrate Celery to LangGraph persistence"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
