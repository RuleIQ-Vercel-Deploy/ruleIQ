<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruleIQ - Code Cartographer Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            background: white;
            border-radius: 1rem;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        
        .subtitle {
            color: #6b7280;
            font-size: 1.25rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }
        
        h3 {
            font-size: 1.5rem;
            color: var(--primary);
            margin: 1.5rem 0 1rem;
        }
        
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .tech-category {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary);
        }
        
        .tech-category h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .tech-list {
            list-style: none;
            margin-top: 0.5rem;
        }
        
        .tech-list li {
            padding: 0.25rem 0;
            color: #4b5563;
        }
        
        .tech-list li:before {
            content: "→ ";
            color: var(--secondary);
            font-weight: bold;
        }
        
        .workflow-diagram {
            background: var(--light);
            padding: 2rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .workflow-nodes {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 800px;
        }
        
        .workflow-node {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            position: relative;
            flex: 1;
            margin: 0 0.5rem;
        }
        
        .workflow-node:not(:last-child)::after {
            content: "→";
            position: absolute;
            right: -1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .risk-card {
            padding: 1.5rem;
            border-radius: 0.5rem;
            border-left: 4px solid;
        }
        
        .risk-critical {
            background: #fef2f2;
            border-color: var(--danger);
        }
        
        .risk-high {
            background: #fef3c7;
            border-color: var(--warning);
        }
        
        .risk-medium {
            background: #dbeafe;
            border-color: var(--info);
        }
        
        .risk-low {
            background: #f0fdf4;
            border-color: var(--secondary);
        }
        
        .risk-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .risk-critical .risk-title { color: var(--danger); }
        .risk-high .risk-title { color: var(--warning); }
        .risk-medium .risk-title { color: var(--info); }
        .risk-low .risk-title { color: var(--secondary); }
        
        .metrics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .metrics-table th,
        .metrics-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .metrics-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }
        
        .metrics-table tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fed7aa;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .architecture-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }
        
        .feature-card h4 {
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }
        
        .recommendations {
            background: #f0f9ff;
            border: 2px solid #0284c7;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .recommendations h4 {
            color: #0284c7;
            margin-bottom: 1rem;
        }
        
        .recommendations ul {
            list-style: none;
            margin-left: 0;
        }
        
        .recommendations li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e0f2fe;
        }
        
        .recommendations li:before {
            content: "✓ ";
            color: #0284c7;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        footer {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        
        .phase-indicator {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
            padding: 1rem;
            background: white;
            border-radius: 0.5rem;
        }
        
        .phase-step {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            position: relative;
        }
        
        .phase-step.completed {
            color: var(--secondary);
            font-weight: bold;
        }
        
        .phase-step.completed::after {
            content: "✓";
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ruleIQ Code Cartographer Analysis</h1>
            <p class="subtitle">Comprehensive Repository Analysis & Architecture Deep-Dive</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">1,467</div>
                    <div class="stat-label">Total Files</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">200K+</div>
                    <div class="stat-label">Lines of Code</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">87%</div>
                    <div class="stat-label">Test Coverage</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">53</div>
                    <div class="stat-label">Directories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">4</div>
                    <div class="stat-label">AI Models</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">2</div>
                    <div class="stat-label">Databases</div>
                </div>
            </div>
        </header>

        <div class="phase-indicator">
            <div class="phase-step completed">Phase 1: Inventory</div>
            <div class="phase-step completed">Phase 2: MAP</div>
            <div class="phase-step completed">Phase 3: Folder INDEX</div>
            <div class="phase-step completed">Phase 4: File INDEX</div>
            <div class="phase-step completed">Phase 5: Deep-Dives</div>
            <div class="phase-step completed">Phase 6: Cross-Cutting</div>
        </div>

        <section class="section">
            <h2>🏗️ Architecture Overview</h2>
            
            <div class="architecture-features">
                <div class="feature-card">
                    <h4>IQ Agent System</h4>
                    <p>1,240-line autonomous compliance orchestrator with 6-node LangGraph workflow for intelligent decision-making.</p>
                </div>
                <div class="feature-card">
                    <h4>Dual Database Strategy</h4>
                    <p>PostgreSQL for business data combined with Neo4j graph database for complex compliance relationships.</p>
                </div>
                <div class="feature-card">
                    <h4>Multi-Jurisdiction Support</h4>
                    <p>Comprehensive coverage of UK (FCA/PRA), EU (GDPR/DORA), and US (SOC2/SOX) regulations.</p>
                </div>
                <div class="feature-card">
                    <h4>AI-Powered RAG</h4>
                    <p>Advanced retrieval-augmented generation with GPT-4, Mistral, and Google AI integration.</p>
                </div>
            </div>

            <h3>IQ Agent Workflow</h3>
            <div class="workflow-diagram">
                <div class="workflow-nodes">
                    <div class="workflow-node">
                        <strong>PERCEIVE</strong>
                        <br><small>Query GraphRAG</small>
                    </div>
                    <div class="workflow-node">
                        <strong>PLAN</strong>
                        <br><small>Risk Assessment</small>
                    </div>
                    <div class="workflow-node">
                        <strong>ACT</strong>
                        <br><small>Execute Actions</small>
                    </div>
                    <div class="workflow-node">
                        <strong>LEARN</strong>
                        <br><small>Pattern Analysis</small>
                    </div>
                    <div class="workflow-node">
                        <strong>REMEMBER</strong>
                        <br><small>Update Memory</small>
                    </div>
                    <div class="workflow-node">
                        <strong>RESPOND</strong>
                        <br><small>Generate Output</small>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>💻 Technology Stack</h2>
            
            <div class="tech-stack">
                <div class="tech-category">
                    <h4>Backend</h4>
                    <ul class="tech-list">
                        <li>FastAPI 0.115</li>
                        <li>Python 3.11+</li>
                        <li>SQLAlchemy 2.0</li>
                        <li>Pydantic 2.11</li>
                        <li>Alembic Migrations</li>
                    </ul>
                </div>
                
                <div class="tech-category">
                    <h4>Frontend</h4>
                    <ul class="tech-list">
                        <li>Next.js 15.3</li>
                        <li>React 19.1</li>
                        <li>TypeScript 5.0</li>
                        <li>TailwindCSS 3.4</li>
                        <li>shadcn/ui Components</li>
                    </ul>
                </div>
                
                <div class="tech-category">
                    <h4>AI/ML Stack</h4>
                    <ul class="tech-list">
                        <li>OpenAI GPT-4</li>
                        <li>Google Gemini</li>
                        <li>Mistral AI</li>
                        <li>LangGraph</li>
                        <li>Vector Embeddings</li>
                    </ul>
                </div>
                
                <div class="tech-category">
                    <h4>Databases</h4>
                    <ul class="tech-list">
                        <li>PostgreSQL (Neon)</li>
                        <li>Neo4j Graph</li>
                        <li>Redis Cache</li>
                        <li>Vector Store</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>⚠️ Risk Analysis</h2>
            
            <div class="risk-grid">
                <div class="risk-card risk-critical">
                    <div class="risk-title">🔴 JWT Migration Incomplete</div>
                    <p>60+ backup files indicate incomplete auth system migration. Immediate cleanup required.</p>
                </div>
                
                <div class="risk-card risk-critical">
                    <div class="risk-title">🔴 Dual Database Sync</div>
                    <p>No distributed transactions between PostgreSQL and Neo4j. Risk of data inconsistency.</p>
                </div>
                
                <div class="risk-card risk-high">
                    <div class="risk-title">🟡 Celery/LangGraph Hybrid</div>
                    <p>70% migration complete. Dual maintenance overhead and performance inconsistency.</p>
                </div>
                
                <div class="risk-card risk-high">
                    <div class="risk-title">🟡 No Connection Pooling</div>
                    <p>Neo4j queries lack pooling, creating scalability bottlenecks.</p>
                </div>
                
                <div class="risk-card risk-medium">
                    <div class="risk-title">🟠 Test Flakiness</div>
                    <p>Integration tests fail intermittently, affecting CI/CD reliability.</p>
                </div>
                
                <div class="risk-card risk-low">
                    <div class="risk-title">🟢 Documentation Gaps</div>
                    <p>45% documentation coverage. Architecture diagrams missing.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>📊 Code Quality Metrics</h2>
            
            <table class="metrics-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Current Value</th>
                        <th>Target</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Test Coverage</td>
                        <td>87%</td>
                        <td>95%</td>
                        <td><span class="badge badge-success">Good</span></td>
                    </tr>
                    <tr>
                        <td>Cyclomatic Complexity</td>
                        <td>12 avg</td>
                        <td><10</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                    </tr>
                    <tr>
                        <td>Technical Debt Ratio</td>
                        <td>15%</td>
                        <td><10%</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                    </tr>
                    <tr>
                        <td>Code Duplication</td>
                        <td>8%</td>
                        <td><5%</td>
                        <td><span class="badge badge-success">Good</span></td>
                    </tr>
                    <tr>
                        <td>Documentation Coverage</td>
                        <td>45%</td>
                        <td>80%</td>
                        <td><span class="badge badge-danger">Needs Work</span></td>
                    </tr>
                    <tr>
                        <td>Security Hotspots</td>
                        <td>3</td>
                        <td>0</td>
                        <td><span class="badge badge-warning">Review Needed</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2>🎯 Key Recommendations</h2>
            
            <div class="recommendations">
                <h4>Immediate Actions (Sprint 1-2)</h4>
                <ul>
                    <li>Clean up 60+ JWT backup files to eliminate auth vulnerabilities</li>
                    <li>Implement Neo4j connection pooling to reduce query latency</li>
                    <li>Add distributed tracing for LangGraph workflow debugging</li>
                    <li>Fix flaky integration tests to stabilize CI/CD pipeline</li>
                </ul>
            </div>
            
            <div class="recommendations" style="margin-top: 1rem;">
                <h4>Short-term Goals (Month 1-2)</h4>
                <ul>
                    <li>Complete Celery to LangGraph migration (30% remaining)</li>
                    <li>Implement Redis caching layer for regulation lookups</li>
                    <li>Deploy Prometheus metrics collection</li>
                    <li>Create comprehensive OpenAPI/Swagger documentation</li>
                </ul>
            </div>
            
            <div class="recommendations" style="margin-top: 1rem;">
                <h4>Long-term Vision (Quarter 1-2)</h4>
                <ul>
                    <li>Build GraphQL gateway for unified API</li>
                    <li>Fine-tune custom ML models for compliance domains</li>
                    <li>Implement WebSocket architecture for real-time updates</li>
                    <li>Deploy on Kubernetes for horizontal scaling</li>
                    <li>Add predictive compliance analytics</li>
                </ul>
            </div>
        </section>

        <section class="section">
            <h2>📁 Repository Structure</h2>
            
            <div style="background: var(--light); padding: 1rem; border-radius: 0.5rem; font-family: monospace; overflow-x: auto;">
                <pre>
ruleIQ/
├── api/                 [60+ files] FastAPI routes
│   ├── routers/        API endpoints (JWT migration ongoing)
│   └── schemas/        Pydantic validation models
├── services/           [40+ files] Business logic
│   ├── ai/            AI service implementations
│   ├── compliance/    Compliance engines
│   └── iq_agent.py    Core IQ Agent (1200+ lines)
├── langgraph_agent/    [30+ files] Workflow orchestration
│   ├── graph/         Graph definitions
│   ├── nodes/         Workflow nodes
│   └── models/        State models
├── database/           [20+ files] Data layer
│   ├── models/        SQLAlchemy models
│   └── migrations/    Alembic migrations
├── frontend/           [70+ files] Next.js app
│   ├── app/           App router pages
│   ├── components/    React components
│   └── lib/           Utilities
└── tests/             [150+ files] Test suites
    ├── unit/          Unit tests
    ├── integration/   Integration tests
    └── ai/            AI accuracy tests
                </pre>
            </div>
        </section>

        <footer>
            <p><strong>Generated by Code Cartographer</strong></p>
            <p>Analysis Date: January 9, 2025 | Repository: ruleIQ</p>
            <p>Total Analysis Time: 6 Phases | Files Analyzed: 1,467</p>
        </footer>
    </div>
</body>
</html>