<!DOCTYPE html>
<html>
<head>
    <title>Chat Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        button { margin: 5px; padding: 10px; cursor: pointer; }
        #output { background: #f0f0f0; padding: 10px; margin: 20px 0; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Chat Page Debug</h1>
    
    <h2>1. Check Frontend Page Structure</h2>
    <button onclick="checkPageStructure()">Check Page HTML</button>
    
    <h2>2. Check React Hydration</h2>
    <button onclick="checkReactApp()">Check React App</button>
    
    <h2>3. Direct Component Test</h2>
    <button onclick="testInputRendering()">Test Input Rendering</button>
    
    <h2>4. Load Chat Page in Iframe</h2>
    <button onclick="loadChatPage()">Load Chat Page</button>
    
    <pre id="output"></pre>
    
    <iframe 
        id="chatFrame" 
        style="width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; display: none;">
    </iframe>

    <script>
        const outputEl = document.getElementById('output');
        const frameEl = document.getElementById('chatFrame');
        
        function log(message, type = 'info') {
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            outputEl.innerHTML += `<span class="${className}">${message}</span>\n`;
        }
        
        async function checkPageStructure() {
            outputEl.textContent = '';
            log('Fetching chat page HTML...');
            
            try {
                const response = await fetch('http://localhost:3000/chat');
                const html = await response.text();
                
                // Check for key elements
                const hasReactRoot = html.includes('__next');
                const hasTextarea = html.includes('textarea') || html.includes('Textarea');
                const hasChatInput = html.includes('ChatInput') || html.includes('chat-input');
                const hasButton = html.includes('New Conversation') || html.includes('button');
                
                log(`‚úì Page loaded: ${response.ok}`, response.ok ? 'success' : 'error');
                log(`‚úì React root found: ${hasReactRoot}`, hasReactRoot ? 'success' : 'error');
                log(`‚úì Textarea element: ${hasTextarea}`, hasTextarea ? 'success' : 'error');
                log(`‚úì ChatInput component: ${hasChatInput}`, hasChatInput ? 'success' : 'error');
                log(`‚úì Button elements: ${hasButton}`, hasButton ? 'success' : 'error');
                
                // Check for error messages
                if (html.includes('error') || html.includes('Error')) {
                    log('‚ö† Page contains error messages', 'error');
                }
                
                // Show first 500 chars of body content
                const bodyMatch = html.match(/<body[^>]*>([\s\S]*?)<\/body>/);
                if (bodyMatch) {
                    log('\nBody content preview:');
                    log(bodyMatch[1].substring(0, 500));
                }
                
            } catch (error) {
                log('Error fetching page: ' + error.message, 'error');
            }
        }
        
        async function checkReactApp() {
            outputEl.textContent = '';
            log('Checking React app state...');
            
            // Create a hidden iframe to test
            const testFrame = document.createElement('iframe');
            testFrame.style.display = 'none';
            testFrame.src = 'http://localhost:3000/chat';
            document.body.appendChild(testFrame);
            
            testFrame.onload = () => {
                try {
                    const frameDoc = testFrame.contentDocument || testFrame.contentWindow.document;
                    
                    // Check for React
                    const hasReact = frameDoc.querySelector('#__next');
                    log(`‚úì Next.js root found: ${!!hasReact}`, hasReact ? 'success' : 'error');
                    
                    // Check for input elements
                    const textareas = frameDoc.querySelectorAll('textarea');
                    const inputs = frameDoc.querySelectorAll('input');
                    const buttons = frameDoc.querySelectorAll('button');
                    
                    log(`‚úì Textareas found: ${textareas.length}`, textareas.length > 0 ? 'success' : 'error');
                    log(`‚úì Inputs found: ${inputs.length}`, inputs.length > 0 ? 'success' : 'error');
                    log(`‚úì Buttons found: ${buttons.length}`, buttons.length > 0 ? 'success' : 'error');
                    
                    // Check for specific elements
                    const chatElements = frameDoc.querySelectorAll('[class*="chat"]');
                    log(`‚úì Chat-related elements: ${chatElements.length}`, chatElements.length > 0 ? 'success' : 'error');
                    
                    // Check computed styles
                    if (textareas.length > 0) {
                        const textarea = textareas[0];
                        const styles = window.getComputedStyle(textarea);
                        log(`\nTextarea visibility: ${styles.display !== 'none' ? 'visible' : 'hidden'}`);
                        log(`Textarea dimensions: ${styles.width} x ${styles.height}`);
                    }
                    
                } catch (error) {
                    log('Error checking React app: ' + error.message, 'error');
                }
                
                // Clean up
                setTimeout(() => document.body.removeChild(testFrame), 1000);
            };
        }
        
        async function testInputRendering() {
            outputEl.textContent = '';
            log('Testing direct input rendering...');
            
            // Create a test container with the same structure
            const testDiv = document.createElement('div');
            testDiv.innerHTML = `
                <div style="border-top: 1px solid #ccc; padding: 16px;">
                    <div style="position: relative;">
                        <textarea 
                            placeholder="Ask about compliance, policies, or evidence..."
                            style="width: 100%; resize: none; border-radius: 8px; border: 1px solid #ddd; 
                                   background: rgba(0,0,0,0.05); padding: 12px 96px 12px 12px; min-height: 80px;"
                            rows="3"
                        ></textarea>
                        <div style="position: absolute; bottom: 10px; right: 12px; display: flex; gap: 8px;">
                            <button style="padding: 8px; border: none; background: transparent; cursor: pointer;">üìé</button>
                            <button style="padding: 8px; border: none; background: transparent; cursor: pointer;">‚úâÔ∏è</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(testDiv);
            
            log('‚úì Test input rendered successfully', 'success');
            log('If you can see an input field below, the HTML/CSS is correct.');
            log('The issue is likely with React hydration or component state.');
            
            // Remove after 5 seconds
            setTimeout(() => document.body.removeChild(testDiv), 5000);
        }
        
        function loadChatPage() {
            outputEl.textContent = '';
            log('Loading chat page in iframe...');
            frameEl.style.display = 'block';
            frameEl.src = 'http://localhost:3000/chat';
            
            frameEl.onload = () => {
                log('‚úì Chat page loaded in iframe', 'success');
                log('Check the iframe below for the actual chat interface.');
            };
        }
    </script>
</body>
</html>